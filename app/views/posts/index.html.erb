<div class="posts-index__container">
  <header class="posts-index__header">
    <h2>Three Musketeers insts</h2>
    <div class="posts-index__header-actions">
      <% if current_account %>
        <span>ÐŸÑ€Ð¸Ð²Ñ–Ñ‚, <b><%= current_account.username %></b>!</span>

      <% else %>
        <%= link_to "Ð£Ð²Ñ–Ð¹Ñ‚Ð¸", login_path, class: "link-strong" %>
        <%= link_to "Ð ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ", new_account_path, class: "link-strong" %>
      <% end %>
    </div>
  </header>

  <div class="new-post-wrap">
    <% if current_account %>
      <%= link_to "+ ÐÐ¾Ð²Ð¸Ð¹ Ð´Ð¾Ð¿Ð¸Ñ", new_post_path, class: "new-post-btn" %>
    <% end %>
  </div>

  <% @posts.each do |post| %>
    <div class="post-card">
      
      <div class="post-meta-row">
        <%# Link to the user's profile from the post header %>
        <div class="post-header mb-2">
          <%= link_to post.account.username, account_path(post.account), class: "fw-bold text-dark text-decoration-none" %>
        </div>
        <% if post.account == current_account %>
          <%= link_to "Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸", delete_post_path(post), 
                      data: { confirm: "Ð’Ð¸ Ð²Ð¿ÐµÐ²Ð½ÐµÐ½Ñ–?" }, 
                      class: "link-danger comment-action-link", title: "Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸" %>
        <% end %>
      </div>

      <% if post.image.attached? %>
        <div class="post-image">
          <%= image_tag post.image, class: "" %>
        </div>
      <% end %>
      <p class="post-body"><%= post.body %></p>
      
      <hr>

      <div>
        <%= button_to "â¤ï¸ #{post.reactions.count}", like_post_path(post), method: :post, class: "reactions-btn" %>
      </div>

      <div class="comments-wrap">
        <% post.comments.each do |comment| %>
          <div class="comment-item">
            <p class="comment-author">
              <b><%= comment.account&.username || "ÐÐ½Ð¾Ð½Ñ–Ð¼" %>:</b> <%= comment.body %>
            </p>
            
            <div class="comment-actions">
              <%= button_to "ðŸ‘ #{comment.comment_reactions.count}", 
                            like_post_comment_path(post, comment), 
                            method: :post, 
                            class: "", title: "Like comment" %>

              <% if comment.account == current_account %>
                <%= link_to "ðŸ—‘ï¸", delete_post_comment_path(post, comment), 
                            data: { confirm: "Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ ÐºÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€?" }, 
                            class: "comment-action-link" %>
              <% end %>
            </div>
          </div>
        <% end %>

        <% if current_account %>
          <div class="comment-form-wrap">
            <%= render 'comments/form', post: post %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>