<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      
      <%# Header: Аватар зліва, Інфо справа %>
      <div class="d-flex align-items-start mb-5">
        <div class="profile-avatar-container me-5">
          <% if @account.avatar.attached? %>
            <%= image_tag @account.avatar, class: "rounded-circle profile-avatar-img" %>
          <% else %>
            <div class="rounded-circle profile-avatar-placeholder"><span class="avatar-placeholder-text"><%= @account.username.first.upcase %></span></div>
          <% end %>
        </div>

        <div class="profile-info flex-grow-1">
          <div class="d-flex align-items-center gap-3 mb-3">
            <h2 class="fw-light m-0 text-dark"><%= @account.username %></h2>
          </div>
          
          <%# Статистика %>
          <div class="profile-stats d-flex gap-4 mb-3">
            <span><strong><%= @account.posts.count %></strong> posts</span>
            <span>
              <%= link_to followers_account_path(@account), class: "text-decoration-none text-dark" do %>
                <strong><%= @account.followers.count %></strong> followers
              <% end %>
            </span>
            <span>
              <%= link_to following_account_path(@account), class: "text-decoration-none text-dark" do %>
                <strong><%= @account.following.count %></strong> following
              <% end %>
            </span>
          </div>

          <%# Опис (BIO) %>
          <div class="profile-bio">
            <%# Використовуємо username замість full_name, щоб не було помилок %>
            <div class="fw-bold"><%= @account.username %></div>
            <p class="text-dark mt-1"><%= @account.description %></p>
          </div>
        </div>
      </div>

      <%# ОДНА ДОВГА КНОПКА РЕДАГУВАННЯ %>
      <div class="profile-actions mb-5">
        <% if current_account == @account %>
          <%# Використовуємо edit_profile_path без параметрів, як прописано в routes.rb %>
          <%= link_to "Edit Profile", edit_profile_path, class: "btn btn-outline-secondary w-100 fw-bold" %>
        <% else %>
          <div id="follow_form_<%= @account.id %>" class="w-100">
            <% if current_account.following?(@account) %>
              <% rel = current_account.following_relationships.find_by(followed_id: @account.id) %>
              <%= button_to "Unfollow", relationship_path(rel), method: :delete, class: "btn btn-outline-secondary w-100 fw-bold" %>
            <% else %>
              <%= button_to "Follow", relationships_path(followed_id: @account.id), method: :post, class: "btn btn-primary w-100 fw-bold" %>
            <% end %>
          </div>
        <% end %>
      </div>

      <hr class="mb-5">
      <%# Tabs like Instagram: Posts | Saved | Liked %>
      <nav class="profile-tabs mb-4">
        <div class="nav nav-tabs justify-content-center gap-5">
          <%= link_to my_profile_path(tab: 'posts'), class: "nav-link "+(@tab == 'posts' ? 'active' : '') do %>
            <i class="bi bi-grid text-dark fs-4" aria-hidden="true"></i>
          <% end %>
          <%= link_to my_profile_path(tab: 'saved'), class: "nav-link "+(@tab == 'saved' ? 'active' : '') do %>
            <i class="bi bi-bookmark text-dark fs-4"></i>
          <% end %>
          <%= link_to my_profile_path(tab: 'liked'), class: "nav-link "+(@tab == 'liked' ? 'active' : '') do %>
            <i class="bi bi-heart text-danger fs-4"></i>
          <% end %>
        </div>
      </nav>

      <% if @tab == 'posts' %>
        <div class="profile-posts-grid d-flex flex-wrap gap-1">
          <% @posts.each do |post| %>
            <div class="grid-item">
              <% if post.image.attached? %>
                <%= link_to post_path(post) do %>
                  <%= image_tag post.image, class: "grid-image" %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% elsif @tab == 'saved' %>
        <div class="profile-saved-grid d-flex flex-wrap gap-1">
          <% if @saved_posts.any? %>
            <% @saved_posts.each do |post| %>
              <div class="grid-item">
                <% if post.image.attached? %>
                  <%= link_to post_path(post) do %>
                    <%= image_tag post.image, class: "grid-image" %>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">You haven't saved any posts yet.</p>
          <% end %>
        </div>
      <% else %>
        <div class="profile-liked-grid d-flex flex-wrap gap-1">
          <% if @liked_posts.any? %>
            <% @liked_posts.each do |post| %>
              <div class="grid-item">
                <% if post.image.attached? %>
                  <%= link_to post_path(post) do %>
                    <%= image_tag post.image, class: "grid-image" %>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">You haven't liked any posts yet.</p>
          <% end %>
        </div>
      <% end %>

    </div>
  </div>
</div>